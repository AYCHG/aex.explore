# Bisq BSQ Explorer

## Overview
The BSQ explorer provides basic information about BSQ transactions.
It is based on static html pages which are rendered from json files generated by a Bisq application running on the
server. Beside  http server and Bisq (we run a seednode instance) we require bitcoind as the Bisq node is running in
fullnode mode.


### Installation
Requires Bisq seednode with `--dumpBlockchainData=true`

#### Web Server
```
sudo apt-get update
sudo apt-get install nginx
```

Check that it's running

```
systemctl status nginx
```
Copy nginx.config to /etc/nginx/sites-available and symlink from /etc/nginx/sites-enabled. Remove sym link to
default site. Replace `hostname` with site name.

Install certificate

```
sudo apt-get install software-properties-common
sudo add-apt-repository universe
sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
sudo apt-get install python-certbot-nginx
sudo certbot --nginx
```

Set automatic certificate renewal in crontab. Try to renew every month. Edit crontab...

```
sudo crontab -e
```
...and paste this line2
```
0 0 1 * * certbot renew
```

#### Explorer
Some needed pyhton packages
```
sudo pip install python-bitcoinrpc
sudo pip install simplejson
sudo pip install gitpython
```

Setup variables for other commands below to use:
```
export EXPLORER_HOME=<your full path to explorer>
export DATADIR=<path to bisq db directory>
```

examples:
```
#we assume you cloned this repo to: /home/user/bisq-explorer
#we assume bisq-seednode was run with --appName=seed_2002 and testnet is used as network
export EXPLORER_HOME=/home/user/bisq-explorer
export DATADIR=/home/user/.local/share/seed_2002/btc_testnet/db
```

HTML need to point to explorer/www
```
cd /var/www
sudo ln -s ${EXPLORER_HOME}/www html
```

Copy Bisq seednode db directory contents to `$EXPLORER_HOME`
```
mkdir ${EXPLORER_HOME}/data
cp -r ${DATADIR}/* ${EXPLORER_HOME}/data
```

For the update script `inotifywait` is needed, it's part of inotify-tools
```
sudo apt install inotify-tools
```

#### Bitcoin
Bitcoin blocknotify script needs `nc`
```
sudo apt install netcat-openbsd
```

Example `bitcoin.conf`
```
testnet=1
lang=en

whitelist=127.0.0.1
rpcallowip=127.0.0.1
rpcport=18332  

server=1
txindex=1
rpcuser=bisquser
rpcpassword=bisqpasswd
blocknotify=bash $HOME/.bitcoin/blocknotify %s
```
Example `blocknotify`

```
#!/bin/bash
echo $1 | nc -w 1 127.0.0.1 5110

```
### Run

Copy update_monitor.sh to a location outside of the explorer directory where the
script will be run from. Then edit it to configure the DATADIR and EXPLORER_HOME derictories.

You can use these commands to edit the files:
```
sed -Ei 's|DATADIR=.*|DATADIR='"${DATADIR}"'|' update_monitor.sh
sed -Ei 's|EXPLORER_HOME=.*|EXPLORER_HOME='"${EXPLORER_HOME}"'|' update_monitor.sh
```

To start the update monitor
```
./update_monitor.sh
```

To update the explorer state, using the data from bisq seednode it's possible
to run the update manually.
```
cd ${EXPLORER_HOME}
./update_data.sh ${DATADIR}
```
